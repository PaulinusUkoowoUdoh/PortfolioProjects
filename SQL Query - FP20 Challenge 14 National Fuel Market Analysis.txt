use FP20

select * from dbo.['Fuel_Prices_Argentina_2016-2023$']

--clean the database 
--BY DROPPING ROWS CONTAINING NULLS 
delete from dbo.['Fuel_Prices_Argentina_2016-2023$']
where [Company ID ] IS NULL

--What is the average price of Gasoil Grade 2 across all provinces?
select Province, [Product Type], round(AVG([Price ]),2) as 'Average Price'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
where [Product Type] = 'Gasoil Grade 2'
group by Province, [Product Type]
order by [Average Price] desc

--Which company has the highest total sales by city?
select [Company Name], City, sum([Price ]) as 'Total Sales'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
group by [Company Name], City
order by [Total Sales] desc

--How has the price of Petrol Premium - 95 Octane changed from September 2022 to October 2023?
--USING VARIANCES
select [Year_Month ID], [Product Type], round(var(price),2) Variances
from dbo.['Fuel_Prices_Argentina_2016-2023$']
where [Product Type] = 'Petrol Premium - 95 Octane' and [Year_Month ID] between '2022-08' and '2023-10'
group by [Year_Month ID], [Product Type]
order by [Year_Month ID]

--Which region has the highest average price for Compressed Natural Gas?
select Region, [Product Type], round(avg([Price ]),2) 'Average Price'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
where [Product Type] = 'Compressed Natural Gas'
group by Region, [Product Type]
order by 'Average Price' desc

--Can we observe any significant difference in fuel prices between daytime and nighttime shifts?
select dt.[Year_Month ID], dt.[Shift Type], round(avg(dt.[Price ]),2) 'Daytime Average',
nt.[Shift Type], round(avg(nt.[Price ]),2) 'Nighttime Average'
from dbo.['Fuel_Prices_Argentina_2016-2023$'] as dt
join dbo.['Fuel_Prices_Argentina_2016-2023$'] as nt
on dt.[Year_Month ID] = nt.[Year_Month ID]
where dt.[Shift Type] = 'Daytime' and nt.[Shift Type] = 'Nighttime'
group by dt.[Year_Month ID], dt.[Shift Type], nt.[Shift Type]
order by dt.[Year_Month ID]

--What is the price range for Petrol unleaded - 95/98 Octane in the Buenos Aires province?
Select Province, [Product Type], MIN(Price) 'Min. Price', MAX(Price) 'Max. Price'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
where Province = 'Buenos Aires' and [Product Type] = 'Petrol unleaded - 95/98 Octane'
group by Province, [Product Type]
order by MIN(Price), MAX(Price)

--How many different types of products are sold by the company "AUTOMOVIL CLUB ARGENTINO"?
Select [Company Name], [Product Type], COUNT([Product Type]) 'Product Count'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
where [Company Name] = 'AUTOMOVIL CLUB ARGENTINO'
group by [Company Name], [Product Type]
order by COUNT([Product Type]) desc

--Which city in the Patagonia region has the highest recorded price for any fuel type?
Select City, Region, max(Price) 'Highest recorded price'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
where Region = 'Patagonia'
group by City, Region
order by max(Price) desc

--What are the top 10 companies by sales revenue in 2023? 
Select TOP 10 [Company Name], SUM([Price ]) 'Sales Revenue'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
where year(Date) = '2023'
group by [Company Name]
order by 'Sales Revenue' desc

--What is the total revenue generated by each flagged company if we assume each price corresponds to one sale?
Select [Flag Company], round(sum(Price),2) 'Total Generated Revenue'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
group by [Flag Company]
order by sum(Price) desc

--What was the highest and lowest prices of Gasoil Grade 2 in the province of Buenos Aires during the year 2023?
Select Province, [Product Type], MIN(Price) 'Min. Price', MAX(Price) 'Max. Price'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
where Province = 'Buenos Aires' and [Product Type] = 'Gasoil Grade 2' and year(Date) = '2023'
group by Province, [Product Type]
order by MIN(Price), MAX(Price)

--Which month had the greatest profit win in the prices of Petrol unleaded - 95/98 Octane during the year 2022?
Select [Year_Month ID], max(Price) 'Profit'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
where [Product Type] = 'Petrol unleaded - 95/98 Octane' and year(Date) = '2022'
group by [Year_Month ID]
order by Profit desc

--Are there significant correlations between geographical location (latitude and longitude)
--and product prices for a specific company?
select Region, Province, [Company Name], sum([Price ]) 'Product Prices'
from dbo.['Fuel_Prices_Argentina_2016-2023$']
group by Region, Province, [Company Name]
order by sum([Price ]) desc

--What was the product that showed the highest sales?
select TOP 1 [Product Type], round(sum(Price),2) as Sales
from dbo.['Fuel_Prices_Argentina_2016-2023$']
group by [Product Type]
order by sum(Price) desc

